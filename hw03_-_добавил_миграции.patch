Subject: [PATCH] hw03 - добавил миграции
---
Index: database/migrations/2025_11_19_103615_create_roles_table.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/database/migrations/2025_11_19_103615_create_roles_table.php b/database/migrations/2025_11_19_103615_create_roles_table.php
new file mode 100644
--- /dev/null	(revision b2f1b2d0c324ae65c4708a06c84d092b41c3c175)
+++ b/database/migrations/2025_11_19_103615_create_roles_table.php	(revision b2f1b2d0c324ae65c4708a06c84d092b41c3c175)
@@ -0,0 +1,35 @@
+<?php
+
+use Illuminate\Database\Migrations\Migration;
+use Illuminate\Database\Schema\Blueprint;
+use Illuminate\Support\Facades\Schema;
+
+return new class extends Migration
+{
+    /**
+     * Run the migrations.
+     */
+    public function up(): void
+    {
+        Schema::create('roles', function (Blueprint $table) {
+            $table->id();
+            $table->string('name')->unique(); // admin, mentor, student
+            $table->timestamps();
+        });
+
+        Schema::create('role_user', function(Blueprint $table) {
+            $table->foreignId('role_id')->constrained()->cascadeOnDelete();
+            $table->foreignId('user_id')->constrained()->cascadeOnDelete();
+            $table->unique(['role_id', 'user_id']);
+        });
+    }
+
+    /**
+     * Reverse the migrations.
+     */
+    public function down(): void
+    {
+        Schema::dropIfExists('role_user');
+        Schema::dropIfExists('roles');
+    }
+};
Index: database/migrations/2025_11_19_104353_create_mentor_profiles_table.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/database/migrations/2025_11_19_104353_create_mentor_profiles_table.php b/database/migrations/2025_11_19_104353_create_mentor_profiles_table.php
new file mode 100644
--- /dev/null	(revision b2f1b2d0c324ae65c4708a06c84d092b41c3c175)
+++ b/database/migrations/2025_11_19_104353_create_mentor_profiles_table.php	(revision b2f1b2d0c324ae65c4708a06c84d092b41c3c175)
@@ -0,0 +1,47 @@
+<?php
+
+use Illuminate\Database\Migrations\Migration;
+use Illuminate\Database\Schema\Blueprint;
+use Illuminate\Support\Facades\Schema;
+
+return new class extends Migration
+{
+    /**
+     * Run the migrations.
+     */
+    public function up(): void
+    {
+        Schema::create('mentor_profiles', function (Blueprint $table) {
+            $table->id();
+            $table->foreignId('user_id')->unique()->constrained()->cascadeOnDelete();
+            $table->text('description')->nullable();
+            $table->unsignedTinyInteger('experience_years')->default(0);
+            $table->decimal('rate', 3, 2)->nullable();
+            $table->boolean('is_active')->default(true);
+            $table->timestamps();
+        });
+
+        Schema::create('technologies', function (Blueprint $table) {
+            $table->id();
+            $table->string('name')->unique();
+            $table->string('slug')->unique();
+            $table->timestamps();
+        });
+
+        Schema::create('mentor_technology', function (Blueprint $table) {
+            $table->foreignId('mentor_profile_id')->constrained()->cascadeOnDelete();
+            $table->foreignId('technology_id')->constrained()->cascadeOnDelete();
+            $table->unique(['mentor_profile_id', 'technology_id']);
+        });
+    }
+
+    /**
+     * Reverse the migrations.
+     */
+    public function down(): void
+    {
+        Schema::dropIfExists('mentor_technology');
+        Schema::dropIfExists('technologies');
+        Schema::dropIfExists('mentor_profiles');
+    }
+};
Index: database/migrations/2025_11_19_110443_create_code_submissions_table.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/database/migrations/2025_11_19_110443_create_code_submissions_table.php b/database/migrations/2025_11_19_110443_create_code_submissions_table.php
new file mode 100644
--- /dev/null	(revision b2f1b2d0c324ae65c4708a06c84d092b41c3c175)
+++ b/database/migrations/2025_11_19_110443_create_code_submissions_table.php	(revision b2f1b2d0c324ae65c4708a06c84d092b41c3c175)
@@ -0,0 +1,44 @@
+<?php
+
+use Illuminate\Database\Migrations\Migration;
+use Illuminate\Database\Schema\Blueprint;
+use Illuminate\Support\Facades\Schema;
+
+return new class extends Migration
+{
+    /**
+     * Run the migrations.
+     */
+    public function up(): void
+    {
+        Schema::create('code_submissions', function (Blueprint $table) {
+            $table->id();
+            $table->foreignId('user_id')->constrained()->cascadeOnDelete();
+            $table->string('title');
+            $table->text('description')->nullable();
+            $table->string('language', 50)->nullable();
+            $table->string('status', 32)->default('draft');
+            $table->foreignId('mentor_id')->nullable()->constrained('users')->cascadeOnDelete();
+            $table->timestamps();
+
+            $table->index(['status', 'language']);
+        });
+
+        Schema::create('submission_files', function (Blueprint $table) {
+            $table->id();
+            $table->foreignId('code_submission_id')->constrained()->cascadeOnDelete();
+            $table->string('filename')->nullable();
+            $table->longText('content');
+            $table->timestamps();
+        });
+    }
+
+    /**
+     * Reverse the migrations.
+     */
+    public function down(): void
+    {
+        Schema::dropIfExists('submission_files');
+        Schema::dropIfExists('code_submissions');
+    }
+};
Index: database/migrations/2025_11_19_112335_create_ai_analyses_table.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/database/migrations/2025_11_19_112335_create_ai_analyses_table.php b/database/migrations/2025_11_19_112335_create_ai_analyses_table.php
new file mode 100644
--- /dev/null	(revision b2f1b2d0c324ae65c4708a06c84d092b41c3c175)
+++ b/database/migrations/2025_11_19_112335_create_ai_analyses_table.php	(revision b2f1b2d0c324ae65c4708a06c84d092b41c3c175)
@@ -0,0 +1,54 @@
+<?php
+
+use Illuminate\Database\Migrations\Migration;
+use Illuminate\Database\Schema\Blueprint;
+use Illuminate\Support\Facades\Schema;
+
+return new class extends Migration
+{
+    /**
+     * Run the migrations.
+     */
+    public function up(): void
+    {
+        Schema::create('ai_analyses', function (Blueprint $table) {
+            $table->id();
+            $table->foreignId('code_submission_id')->constrained()->cascadeOnDelete();
+            $table->string('provider')->nullable();
+            $table->text('summary')->nullable();
+            $table->longText('suggestions')->nullable();
+            $table->unsignedTinyInteger('score')->nullable();
+            $table->json('raw_response')->nullable();
+            $table->timestamps();
+        });
+
+        Schema::create('reviews', function (Blueprint $table) {
+            $table->id();
+            $table->foreignId('code_submission_id')->constrained()->cascadeOnDelete();
+            $table->foreignId('mentor_id')->constrained('users')->cascadeOnDelete();
+            $table->string('status')->default('pending');
+            $table->text('comment')->nullable();
+            $table->unsignedTinyInteger('rating')->nullable();
+            $table->timestamps();
+        });
+
+        Schema::create('review_comments', function (Blueprint $table) {
+            $table->id();
+            $table->foreignId('review_id')->constrained()->cascadeOnDelete();
+            $table->foreignId('file_id')->nullable()->constrained('submission_files')->nullOnDelete();
+            $table->unsignedInteger('line_number')->nullable();
+            $table->text('comment');
+            $table->timestamps();
+        });
+    }
+
+    /**
+     * Reverse the migrations.
+     */
+    public function down(): void
+    {
+        Schema::dropIfExists('review_comments');
+        Schema::dropIfExists('reviews');
+        Schema::dropIfExists('ai_analyses');
+    }
+};
